# ä¾èµ–ç‰ˆæœ¬è¯´æ˜Ž

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Žäº†é¡¹ç›®çš„ Python ç‰ˆæœ¬è¦æ±‚ã€Poetry ä¾èµ–ç®¡ç†å’Œç‰ˆæœ¬æŽ§åˆ¶ç­–ç•¥ã€‚

## ðŸ“¦ ä¾èµ–ç®¡ç†å·¥å…·

é¡¹ç›®ä½¿ç”¨ **uv** è¿›è¡Œæžé€Ÿçš„çŽ°ä»£åŒ–ä¾èµ–ç®¡ç†ï¼Œæä¾›ï¼š

- âš¡ **æžé€Ÿå®‰è£…**: ç›¸æ¯” Pip/Poetry å¿« 10-100 å€
- âœ… **ä¾èµ–è§£æž**: è‡ªåŠ¨è§£å†³ç‰ˆæœ¬å†²çª
- âœ… **é”å®šæ–‡ä»¶**: `uv.lock` ç¡®ä¿çŽ¯å¢ƒä¸€è‡´æ€§
- âœ… **è™šæ‹ŸçŽ¯å¢ƒ**: è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç† `.venv`
- âœ… **å·¥ä½œåŒºæ”¯æŒ**: ä¼˜ç§€çš„ monorepo æ”¯æŒ
- âœ… **æž„å»ºç³»ç»Ÿ**: ç¬¦åˆæ ‡å‡†çš„ Pythonæž„å»ºåŽç«¯

## ðŸ Python ç‰ˆæœ¬è¦æ±‚

### pyproject.toml é…ç½®

```toml
[project]
requires-python = ">=3.9"
```

### æŽ¨èé…ç½®
- **ç”Ÿäº§çŽ¯å¢ƒ**: Python 3.10+ (æŽ¨è 3.12 ä»¥èŽ·å¾—æœ€ä½³æ€§èƒ½)
- **å¼€å‘çŽ¯å¢ƒ**: Python 3.12+ (èŽ·å¾—æœ€ä½³å¼€å‘ä½“éªŒ)
- **æœ€ä½Žè¦æ±‚**: Python 3.9 (åŸºç¡€åŠŸèƒ½æ”¯æŒ)

### ç‰ˆæœ¬å…¼å®¹æ€§çŸ©é˜µ

| Pythonç‰ˆæœ¬ | æ”¯æŒçŠ¶æ€ | æŽ¨èç¨‹åº¦ | ä¸»è¦ç‰¹æ€§ | è¯´æ˜Ž |
|-----------|---------|---------|---------|------|
| 3.8 | âŒ ä¸æ”¯æŒ | ä¸æŽ¨è | - | ç¼ºå°‘å¿…è¦çš„ç±»åž‹æ³¨è§£ç‰¹æ€§ |
| 3.9 | âœ… å®Œå…¨æ”¯æŒ | å¯ç”¨ | åŸºç¡€åŠŸèƒ½ | æœ€ä½Žæ”¯æŒç‰ˆæœ¬ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸ |
| 3.10 | âœ… å®Œå…¨æ”¯æŒ | æŽ¨è | ç»“æž„åŒ–æ¨¡å¼åŒ¹é… | Docker é»˜è®¤ç‰ˆæœ¬ï¼Œç¨³å®šå¯é  |
| 3.11 | âœ… å®Œå…¨æ”¯æŒ | å¼ºçƒˆæŽ¨è | æ€§èƒ½ä¼˜åŒ– | æ˜¾è‘—æ€§èƒ½æå‡ï¼Œç±»åž‹æç¤ºå¢žå¼º |
| 3.12 | âœ… å®Œå…¨æ”¯æŒ | æŽ¨è | æ›´å¿«å¯åŠ¨ | æ›´å¿«å¯åŠ¨æ—¶é—´ï¼Œæœ€æ–°ç¨³å®šç‰¹æ€§ |
| 3.13 | âœ… å®Œå…¨æ”¯æŒ | å¯ç”¨ | æœ€æ–°ç‰¹æ€§ | æœ€æ–°ç‰ˆæœ¬ï¼Œå¼€å‘çŽ¯å¢ƒæŽ¨è |

## ðŸ“‹ ä¾èµ–é…ç½®

### pyproject.toml ç»“æž„

```toml
[project]
name = "aistudio2api"
version = "0.1.0"
dependencies = [
    "fastapi==0.115.12",
    # ... å…¶ä»–ç”Ÿäº§ä¾èµ–
]

[dependency-groups]
dev = [
    "pytest>=7.0.0",
    "black>=23.0.0"
]
```

### ç‰ˆæœ¬çº¦æŸè¯­æ³•

uv éµå¾ªæ ‡å‡†çš„ PEP 440 ç‰ˆæœ¬çº¦æŸï¼š

- `==1.2.3` - ç²¾ç¡®ç‰ˆæœ¬
- `>=1.2.3,<2.0.0` - ç‰ˆæœ¬èŒƒå›´
- `~=1.2.3` - å…¼å®¹ç‰ˆæœ¬

## ðŸ”§ æ ¸å¿ƒä¾èµ–ç‰ˆæœ¬

### Web æ¡†æž¶ç›¸å…³
```toml
"fastapi==0.115.12",
"pydantic>=2.7.1,<3.0.0",
"uvicorn==0.29.0"
```

**ç‰ˆæœ¬è¯´æ˜Ž**:
- **FastAPI 0.115.12**: æœ€æ–°ç¨³å®šç‰ˆæœ¬ï¼ŒåŒ…å«æ€§èƒ½ä¼˜åŒ–å’Œæ–°åŠŸèƒ½
  - æ–°å¢ž Query/Header/Cookie å‚æ•°æ¨¡åž‹æ”¯æŒ
  - æ”¹è¿›çš„ç±»åž‹æç¤ºå’ŒéªŒè¯
  - æ›´å¥½çš„ OpenAPI æ–‡æ¡£ç”Ÿæˆ
- **Pydantic 2.7.1+**: çŽ°ä»£æ•°æ®éªŒè¯åº“ï¼Œä½¿ç”¨ç‰ˆæœ¬èŒƒå›´ç¡®ä¿å…¼å®¹æ€§
- **Uvicorn 0.29.0**: é«˜æ€§èƒ½ ASGI æœåŠ¡å™¨

### æµè§ˆå™¨è‡ªåŠ¨åŒ–
```toml
"playwright==1.48.0",
"camoufox[geoip]==0.4.11"
```

**ç‰ˆæœ¬è¯´æ˜Ž**:
- **Playwright**: é”å®šç‰ˆæœ¬ï¼Œç¡®ä¿æµè§ˆå™¨å…¼å®¹æ€§
- **Camoufox 0.4.11**: åæŒ‡çº¹æ£€æµ‹æµè§ˆå™¨ï¼ŒåŒ…å«åœ°ç†ä½ç½®æ•°æ®æ‰©å±•

### ç½‘ç»œå’Œå®‰å…¨
```toml
"aiohttp~=3.9.5",
"requests==2.31.0",
"cryptography==42.0.5",
"pyjwt==2.8.0",
"websockets>=12.0",
"aiosocks~=0.2.6",
"python-socks~=2.7.1"
```

**ç‰ˆæœ¬è¯´æ˜Ž**:
- **aiohttp ~3.9.5**: å¼‚æ­¥HTTPå®¢æˆ·ç«¯ï¼Œå…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–°
- **cryptography 42.0.5**: åŠ å¯†åº“ï¼Œå›ºå®šç‰ˆæœ¬ç¡®ä¿å®‰å…¨æ€§
- **websockets 12.0**: WebSocket æ”¯æŒ
- **requests 2.31.0**: HTTP å®¢æˆ·ç«¯åº“

### ç³»ç»Ÿå·¥å…·
```toml
"python-dotenv==1.0.1",
"httptools>=0.6.4",
"uvloop; sys_platform != 'win32'",
"Flask==3.0.3"
```

**ç‰ˆæœ¬è¯´æ˜Ž**:
- **uvloop**: ä»…åœ¨éž Windows ç³»ç»Ÿå®‰è£…ï¼Œæ˜¾è‘—æå‡æ€§èƒ½
- **httptools**: HTTP è§£æžä¼˜åŒ–
- **python-dotenv**: çŽ¯å¢ƒå˜é‡ç®¡ç†
- **Flask**: ç”¨äºŽç‰¹å®šåŠŸèƒ½çš„è½»é‡çº§ Web æ¡†æž¶

## ðŸ”„ uv ä¾èµ–ç®¡ç†å‘½ä»¤

### åŸºç¡€å‘½ä»¤

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
uv sync

# æ·»åŠ æ–°ä¾èµ–
uv add package_name

# æ·»åŠ å¼€å‘ä¾èµ–
uv add --dev package_name

# ç§»é™¤ä¾èµ–
uv remove package_name

# æŸ¥çœ‹ä¾èµ–æ ‘
uv tree

# å¯¼å‡º requirements.txt (å…¼å®¹æ€§)
uv pip compile pyproject.toml -o requirements.txt
```

### é”å®šæ–‡ä»¶ç®¡ç†

```bash
# æ›´æ–°é”å®šæ–‡ä»¶
uv lock
```

## ðŸ“Š ä¾èµ–æ›´æ–°ç­–ç•¥

### è‡ªåŠ¨æ›´æ–° (ä½¿ç”¨ ~ ç‰ˆæœ¬èŒƒå›´)
- `aiohttp~=3.9.5` - å…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–° (3.9.5 â†’ 3.9.x)
- `aiosocks~=0.2.6` - å…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–° (0.2.6 â†’ 0.2.x)
- `python-socks~=2.7.1` - å…è®¸è¡¥ä¸ç‰ˆæœ¬æ›´æ–° (2.7.1 â†’ 2.7.x)

### å›ºå®šç‰ˆæœ¬ (ä½¿ç”¨ == ç²¾ç¡®ç‰ˆæœ¬)
- æ ¸å¿ƒæ¡†æž¶ç»„ä»¶ (FastAPI, Uvicorn, python-dotenv)
- å®‰å…¨ç›¸å…³åº“ (cryptography, pyjwt, requests)
- ç¨³å®šæ€§è¦æ±‚é«˜çš„ç»„ä»¶ (websockets, httptools)

### å…¼å®¹ç‰ˆæœ¬ (ä½¿ç”¨ç‰ˆæœ¬èŒƒå›´)
- `pydantic>=2.7.1,<3.0.0` - ä¸»ç‰ˆæœ¬å†…å…¼å®¹æ›´æ–°

### æœ€æ–°ç‰ˆæœ¬ (ä½¿ç”¨ * æˆ–æ— é™åˆ¶)
- `playwright = "*"` - æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼Œéœ€è¦æœ€æ–°åŠŸèƒ½
- `uvloop = "*"` - æ€§èƒ½ä¼˜åŒ–åº“ï¼ŒæŒç»­æ›´æ–°

## ç‰ˆæœ¬å‡çº§å»ºè®®

### å·²å®Œæˆçš„ä¾èµ–å‡çº§
1. **FastAPI**: 0.111.0 â†’ 0.115.12 âœ…
   - æ–°å¢ž Query/Header/Cookie å‚æ•°æ¨¡åž‹åŠŸèƒ½
   - æ”¹è¿›çš„ç±»åž‹æç¤ºå’ŒéªŒè¯æœºåˆ¶
   - æ›´å¥½çš„ OpenAPI æ–‡æ¡£ç”Ÿæˆå’Œå¼‚æ­¥æ€§èƒ½
   - å‘åŽå…¼å®¹ï¼Œæ— ç ´åæ€§å˜æ›´
   - å¢žå¼ºçš„ä¸­é—´ä»¶æ”¯æŒå’Œé”™è¯¯å¤„ç†

2. **Pydantic**: å›ºå®šç‰ˆæœ¬ â†’ ç‰ˆæœ¬èŒƒå›´ âœ…
   - ä»Ž `pydantic==2.7.1` æ›´æ–°ä¸º `pydantic>=2.7.1,<3.0.0`
   - ç¡®ä¿ä¸Ž FastAPI 0.115.12 çš„å®Œç¾Žå…¼å®¹æ€§
   - å…è®¸è‡ªåŠ¨èŽ·å–è¡¥ä¸ç‰ˆæœ¬æ›´æ–°å’Œå®‰å…¨ä¿®å¤
   - æ”¯æŒæœ€æ–°çš„æ•°æ®éªŒè¯ç‰¹æ€§

3. **å¼€å‘å·¥å…·é“¾çŽ°ä»£åŒ–**: âœ…
   - Poetry ä¾èµ–ç®¡ç†æ›¿ä»£ä¼ ç»Ÿ requirements.txt
   - Pyright ç±»åž‹æ£€æŸ¥æ”¯æŒï¼Œæå‡å¼€å‘ä½“éªŒ
   - æ¨¡å—åŒ–é…ç½®ç®¡ç†ï¼Œæ”¯æŒ .env æ–‡ä»¶

### å¯é€‰çš„æ¬¡è¦ä¾èµ–æ›´æ–°
- `charset-normalizer`: 3.4.1 â†’ 3.4.2
- `click`: 8.1.8 â†’ 8.2.1
- `frozenlist`: 1.6.0 â†’ 1.6.2

### å‡çº§æ³¨æ„äº‹é¡¹
- åœ¨æµ‹è¯•çŽ¯å¢ƒä¸­å…ˆéªŒè¯å…¼å®¹æ€§
- å…³æ³¨ FastAPI ç‰ˆæœ¬æ›´æ–°çš„ breaking changes
- å®šæœŸæ£€æŸ¥å®‰å…¨æ¼æ´žæ›´æ–°

## çŽ¯å¢ƒç‰¹å®šé…ç½®

### Docker çŽ¯å¢ƒ
- **åŸºç¡€é•œåƒ**: `python:3.10-slim-bookworm`
- **ä¾èµ–å®‰è£…**: ä½¿ç”¨ `uv pip install`
- **Pythonç‰ˆæœ¬**: å›ºå®šä¸º 3.10 (å®¹å™¨å†…)

### å¼€å‘çŽ¯å¢ƒ
- **æŽ¨è**: Python 3.12+
- **è™šæ‹ŸçŽ¯å¢ƒ**: uv è‡ªåŠ¨ç®¡ç†çš„ `.venv`
- **IDEæ”¯æŒ**: é…ç½®äº† pyrightconfig.json

### ç”Ÿäº§çŽ¯å¢ƒ
- **æŽ¨è**: Python 3.10 æˆ– 3.12
- **ç¨³å®šæ€§**: ä½¿ç”¨ `uv.lock` é”å®šä¾èµ–

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜
1. **Python 3.8 å…¼å®¹æ€§é—®é¢˜**
   - uv ä¼šè‡ªåŠ¨æ£€æŸ¥ python ç‰ˆæœ¬è¦æ±‚

2. **ä¾èµ–ç‰ˆæœ¬å†²çª**
   - `uv lock` ä¼šè‡ªåŠ¨è§£å†³å¤§éƒ¨åˆ†å†²çª
   - æ¸…ç†ç¼“å­˜: `uv cache clean`

3. **ç³»ç»Ÿä¾èµ–ç¼ºå¤±**
   - Linux: å®‰è£… `xvfb` ç”¨äºŽè™šæ‹Ÿæ˜¾ç¤º
   - è¿è¡Œ `uv run playwright install-deps`

### ç‰ˆæœ¬æ£€æŸ¥å‘½ä»¤
```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
uv run python --version

# æ£€æŸ¥å·²å®‰è£…åŒ…ç‰ˆæœ¬
uv pip list
```

## æ›´æ–°æ—¥å¿—

### 2025-11-26
- **é‡è¦æ›´æ–°**: è¿ç§»è‡³ `uv` åŒ…ç®¡ç†å™¨
- **é‡è¦æ›´æ–°**: FastAPI é”å®š 0.115.12
- æ›´æ–°æ‰€æœ‰æ–‡æ¡£ä»¥åæ˜  uv å‘½ä»¤
