services:
  aistudio-proxy:
    build: .
    container_name: aistudio-proxy
    restart: unless-stopped
    ports:
      - "2048:2048"
      - "3120:3120"
      # - "9000:9000" # Web 管理界面 (如果需要请取消注释并修改 command)
      # - "9222:9222" # 浏览器调试端口 (可选)
    environment:
      - TZ=Asia/Shanghai
      - LAUNCH_MODE=virtual_headless # 推荐 Docker 环境使用虚拟显示模式
      - SERVER_LOG_LEVEL=INFO
      - STREAM_PORT=3120
      # - UNIFIED_PROXY_CONFIG=http://host.docker.internal:7890 # 如果需要代理
    volumes:
      - ./auth_profiles:/app/auth_profiles # 持久化认证文件
      - ./logs:/app/logs                   # 持久化日志
      - ./certs:/app/certs                 # 持久化证书
      - ./.env:/app/.env                   # 挂载配置文件
    # 默认启动命令
    command: uv run python launch_camoufox.py --headless --virtual-display --server-port 2048 --stream-port 3120 --internal-camoufox-proxy "${UNIFIED_PROXY_CONFIG:-}"

    # 如果你想使用 Web 管理界面 (Manager GUI)，请使用以下 command 并开放 9000 端口:
    # command: uv run python app_launcher.py
    # environment:
    #   - MANAGER_HOST=0.0.0.0
    #   - NO_BROWSER_AUTO_OPEN=true